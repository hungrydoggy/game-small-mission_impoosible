Obj:
  nam: 'minjun'
  dat:
    'type': 'player'
    'move_vel': 170
    'hp': 5
    'is_invincible': false

  fnc:
    '%onInit':
      '''{(GameObject* self)
        self->sendMessage("/scene_state", "onHpUpdated", {Var(self->getData("hp", 10))});
      '''
    '~incHp':
      '''{(GameObject* self, ,,, vector<Var> msg_params)
        unlikely (msg_params.size() < 1) {
          LOG_ERR("need params --- int hp_inc");
          return null_var;
        }

        auto hp_inc = msg_params[0].as<int>();
        auto hp = math::clamp(self->getData("hp", 5) + hp_inc, 0, 10);
        self->setData("hp", hp);
        self->sendMessage("/scene_state", "onHpUpdated", {Var(hp)});
      '''

  #scl: [3, 3, 1]
  chl:
    #- Obj:
    #  pos: [0, 0, 1000]
    #  col: [1, 0, 0, 1]
    #  vie:
    #    Image:
    #      tex: '%white'
    #      siz: [1, 0]
    - Cmp:
      nam: 'view'
      fnc: '@plugins/child_selector/select_child.fnc'
      pos: [0, 30, 0]
      chl:
        - Obj:
          nam: 'idle'
          pos: [-2.7, 0, 0]
          vie:
            Sprite:
              cnt: -1
              cel:
                '!sprite.cellsBySheet':
                  tex: './sprites/idle.png'
                  row: 6
                  col: 6
                  idx:
                    '!seq.concat':
                      - '!seq.intSeq': {'start':3, 'end':15}
                      - '!seq.intSeq': {'start':14, 'end': 2}
                  frm: 3
                  siz: {'!relh.pair':[0, 132]}
                  mat: 'transparent'
        - Obj:
          nam: 'run'
          pos: [1.3, 1, 0]
          vie:
            Sprite:
              cnt: -1
              cel:
                '!sprite.cellsBySheet':
                  tex: './sprites/run.png'
                  row: 6
                  col: 6
                  idx: [
                    29, 30, 31, 32,
                    25, 26, 27, 28,
                    29, 30, 31, 32,
                    25, 26, 27, 28,
                    29, 30, 31, 32,
                    25, 26, 27,  2,
                    3,  4,  5,  6,
                    24,  8, 10, 11,
                  ]
                  frm: 4
                  siz: {'!relh.pair':[0, 143]}
                  mat: 'transparent'
        - Obj:
          nam: 'hit'
          pos: [-0.7, 0, 0]
          vie:
            Sprite:
              cnt: 1
              cel:
                '!sprite.cellsBySheet':
                  tex: './sprites/hit.png'
                  row: 3
                  col: 3
                  idx: [0, 0, 1, 2, 3, 4, 5, 6, 7, 8]
                  frm: 5
                  siz: {'!relh.pair':[0, 161]}
                  mat: 'transparent'
              acl:
                - CellActionItem:
                  idx: 9
                  act:
                    SendMessage:
                      dst: '~'
                      nam: 'onEndHitSprite'
          trt:
            - ActionState:
        - Obj:
          nam: 'ko'
          pos: [-0.7, 0, 0]
          vie:
            Sprite:
              cnt: 1
              cel:
                '!seq.concat':
                  - '!sprite.cellsBySheet':
                    tex: './sprites/ko.png'
                    row: 4
                    col: 4
                    idx: 10
                    frm: 5
                    siz: {'!relh.pair':[0, 158]}
                    mat: 'transparent'
                  -
                    - Cell:
                      frm: 5
                      pos: [10, 0, 0]
                      rot: [0, 0, -15]
                      img:
                        Image:
                          tex: './sprites/ko.png'
                          siz: {'!relh.pair':[0, 158]}
                          rgn: [0.25, 0.5, 0.25, 0.25]
                          mat: 'transparent'
                    - Cell:
                      frm: 5
                      pos: [22, -8, 0]
                      rot: [0, 0, 15]
                      img:
                        Image:
                          tex: './sprites/ko.png'
                          siz: {'!relh.pair':[0, 74]}
                          reg: [268, 317, 123, 74]
                          mat: 'transparent'
                    - Cell:
                      frm: 5
                      pos: [30, -17, 0]
                      img:
                        Image:
                          tex: './sprites/ko.png'
                          siz: {'!relh.pair':[0, 76]}
                          reg: [19, 554, 150, 76]
                          mat: 'transparent'
                    - Cell:
                      frm: 5
                      pos: [32, -15, 0]
                      img:
                        Image:
                          tex: './sprites/ko.png'
                          siz: {'!relh.pair':[0, 75]}
                          reg: [20, 476, 148, 75]
                          mat: 'transparent'
                    - Cell:
                      frm: 5
                      pos: [34, -17, 0]
                      img:
                        Image:
                          tex: './sprites/ko.png'
                          siz: {'!relh.pair':[0, 76]}
                          reg: [19, 554, 150, 76]
                          mat: 'transparent'
  bdy:
    BulletBody:
      mas: 0
      grp: ['player']
      msk: ['projectile.enemy', 'item']
  shp:
    - BulletBox:
      pos: [0, 28, 0]
      hsz: [10, 30, 1000]

  acl:
    - ActionItem:
      nam: 'hit'
      act:
        Sequence:
          chl:
            - ColorTo:
              dur: 0
              val: [10, 10, 10, 1]
            - Wait:
              dur: 0.032
            - ColorTo:
              dur: 0
              val: [1, 0, 0, 1]
            - Wait:
              dur: 0.032
            - ColorTo:
              dur: 0
              val: [1, 1, 1, 1]
    - ActionItem:
      nam: 'invincible'
      act:
        Sequence:
          chl:
            - Script:
              scr:
                '''{(ActionState* state)
                  state->owner()->setData("is_invincible", true);
                '''
            - Repeat:
              cnt: 8
              chl:
                - AlphaTo:
                  dur: 0
                  val: 0
                - Wait:
                  dur: 0.1
                - AlphaTo:
                  dur: 0
                  val: 1
                - Wait:
                  dur: 0.2
            - Script:
              scr:
                '''{(ActionState* state)
                  state->owner()->setData("is_invincible", false);
                '''

  trt:
    - '@./playable.obj.fsm'
