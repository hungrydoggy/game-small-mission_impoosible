Obj:
  nam: 'rollroll'

  fnc:
    '~dropItem':
      '''{(GameObject* self, ,,, vector<Var> msg_params)
        unlikely (msg_params.size() < 3) {
          LOG_ERR("need params --- GameComponent* item, real x, real y");
          return null_var;
        }

        auto item  = msg_params[0].v<GameComponent*>();
        auto dst_x = msg_params[1].as<real>();
        auto dst_y = msg_params[2].as<real>();

        auto action_state = self->getTrait<ActionState>("action_state");
        action_state->setData("drop_dst.x", dst_x);
        action_state->setData("drop_dst.y", dst_y);

        self->setData("holding", item);
        self->sendMessage(".", "toAppearFsmState");
      '''

  #scl: [4, 4, 4]
  chl:
    #- Obj:
    #  pos: [0, 0, 1000]
    #  col: [1, 0, 0, 1]
    #  vie: { Image: { tex: '%white', siz: [2, 0] } }
    - Obj:
      nam: 'view'
      pos: [40, 25, 0]
      vie:
        Sprite:
          cnt: -1
          cel:
            '!seq.map':
              src: {'!seq.intSeq':{'end':8}}
              nod:
                Cell:
                  frm: 6
                  img:
                    Image:
                      tex: {'!+':['./', '$e', '.png']}
                      siz: {'!relh.pair':[0, 136]}
                      mat: 'transparent'
      chl:
        - Obj:
          dra: false
          upd: false
          nam: 'pivot.item'
          pos: [-40, -25, 1]
          col: [0, 1, 0, 1]
          vie:
            Image:
              tex: '%white'
              siz: [2, 0]
      acl:
        - ActionItem:
          nam: '%onInit'
          act:
            Repeat:
              cnt: -1
              chl:
                - MoveYBy:
                  dur: 0.5
                  val: 5
                  int: out_quad
                - MoveYBy:
                  dur: 0.5
                  val: -5
                  int: out_quad
  acl:
    - ActionItem:
      nam: 'appear'
      act:
        Sequence:
          chl:
            - MoveXTo:
              dur: 0
              val: {ActionDataRef:{key:'start.x'}}
            - MoveYTo:
              dur: 0
              val: 200

            - Parallel:
              chl:
                - MoveXTo:
                  dur: 2
                  val: {ActionDataRef:{key:'drop_dst.x'}}
                  int: in_out_quad
                - MoveYTo:
                  dur: 2
                  val: {ActionDataRef:{key:'drop_dst.y'}}
                  int: out_quad
            - Wait:
              dur: 0.2
            - SendMessage:
              dst: '.'
              nam: 'drop'
    - ActionItem:
      nam: 'disappear'
      act:
        Sequence:
          chl:
            - Parallel:
              chl:
                - MoveXTo:
                  dur: 1.7
                  val: {ActionDataRef:{key:'end.x'}}
                  int: out_quad
                - MoveYTo:
                  dur: 1.7
                  val: 200
                  int: in_quad
            - Deactivate:
            - SendMessage:
              dst: '.'
              nam: 'toInactiveFsmState'

  trt:
    - '@./rollroll.fsm'
